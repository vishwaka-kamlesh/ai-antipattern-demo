rules:

  # 1. Empty catch blocks
  - id: empty-catch-block
    message: "Empty catch block. Handle or log the exception."
    languages: [java]
    severity: ERROR
    pattern: |
      catch ($EX) {}

  # 2. printStackTrace
  - id: no-print-stacktrace
    message: "Avoid printStackTrace(); use proper logging."
    severity: ERROR
    languages: [java]
    pattern: |
      $E.printStackTrace()

  # 3. System.out.println
  - id: no-system-out
    message: "Avoid System.out.println; use logging framework."
    severity: ERROR
    languages: [java]
    pattern: |
      System.out.println($X)

  # 4. Logging sensitive data
  - id: logging-sensitive-data
    message: "Do not log sensitive data (password, token, PAN, phone, email)."
    severity: ERROR
    languages: [java]
    pattern-regex: "(?i)logger\\.(info|debug|warn|error).*?(password|token|secret|card|phone|email)"

  # 5. Hardcoded Secrets
  - id: hardcoded-credentials
    message: "Hardcoded credential found; use secrets manager/config."
    severity: ERROR
    languages: [java]
    pattern-regex: "(?i)(password|token|secret|apikey)\\s*=\\s*\".+\""

  # 6. Hardcoded URLs
  - id: hardcoded-url
    message: "Hardcoded URL detected. Move to config."
    severity: ERROR
    languages: [java]
    pattern-regex: "\"https?://[^\"]+\""

  # 7. SQL string concatenation
  - id: sql-concat
    message: "SQL concatenation is vulnerable to injection."
    severity: ERROR
    languages: [java]
    pattern-regex: "\"(?i)select .*\"\\s*\\+"

  # 8. Thread.sleep
  - id: no-thread-sleep
    message: "Thread.sleep() blocks the thread â€“ avoid in backend."
    severity: ERROR
    languages: [java]
    pattern: |
      Thread.sleep(...)

  # 9. String concat in loops
  - id: concat-in-loop
    message: "String concatenation inside loops; use StringBuilder."
    severity: ERROR
    languages: [java]
    pattern: |
      for (...) { $S = $S + $X; }

  # 10. Object creation in loop
  - id: object-in-loop
    message: "Object creation inside loop harms performance."
    severity: ERROR
    languages: [java]
    pattern: |
      for (...) { new $OBJ(...); }

  # 11. N+1 query detection
  - id: nplus1-query
    message: "Possible N+1 query: DB call inside loop."
    severity: ERROR
    languages: [java]
    pattern: |
      for (...) { $DB.$METHOD(...); }

  # 12. String == comparison
  - id: string-eq-operator
    message: "Use .equals() instead of == for String comparison."
    severity: ERROR
    languages: [java]
    pattern: |
      if ($X == $Y) ...
    metavariable-types:
      $X: java.lang.String
      $Y: java.lang.String

  # 13. DTO fields must be private
  - id: dto-non-private-field
    message: "DTO fields must be private."
    severity: ERROR
    languages: [java]
    pattern: |
      public class $DTO { public $T $FIELD; }

  # 14. Unused imports
  - id: unused-import
    message: "Unused import detected."
    severity: WARNING
    languages: [java]
    pattern: import $X;
    # Actual unused detection comes from Semgrep metadata

  # 15. Magic numbers (only assignments or returns)
  - id: magic-number
    message: "Magic number detected. Use named constant."
    severity: WARNING
    languages: [java]
    pattern-either:
      - pattern: |
          $X = $NUM
      - pattern: |
          return $NUM
    metavariable-pattern:
      metavariable: $NUM
      pattern-regex: "^[2-9]$|^[1-9][0-9]+$"

  # 16. Field injection forbidden
  - id: no-field-autowired
    message: "Field injection banned. Use constructor injection."
    severity: ERROR
    languages: [java]
    pattern: |
      @Autowired
      private $T $FIELD;
